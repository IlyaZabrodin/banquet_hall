{% extends 'orders_base.html' %}

{% block nav_items %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('bp_order_make.order_make') }}">–û—Ñ–æ—Ä–º–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑</a>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            –†–∞–±–æ—Ç–∞ —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏
        </a>
        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li><a class="dropdown-item" href="{{ url_for('bp_query.form_render') }}">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</a></li>
        </ul>
    </li>
{% endblock %}
{% block external_user_menu %}
<div class="orders-container">
    <h2 class="mb-4">–ú–æ–∏ –∑–∞–∫–∞–∑—ã üî•</h2>
    {% if render_data['status'] %}
    <table class="orders-table user">
        <thead>
            <tr>
                <th>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</th>
                <th>–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for id, status, time in render_data['data'] %}
            <tr class="{% if status != '–ó–∞–≤–µ—Ä—à–µ–Ω' %}new-order{% endif %}">
                <td><span class="order-number">#{{ id }}</span></td>
                <td>
                    {% set status_info = {
                        '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ': {
                            'class': 'status-processing',
                            'message': '–û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞. –°–∫–æ—Ä–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫.'
                        },
                        '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω': {
                            'class': 'status-confirmed',
                            'message': '–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å –±–ª—é–¥–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –±–∞–Ω–∫–µ—Ç–∞. –ù–∞–ø–æ–º–∏–Ω–∞–µ–º, –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞ –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∞–≤–∞–Ω—Å–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –∑–∞ 2 –¥–Ω—è, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞—à–∏–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏.'
                        },
                        '–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–æ—Ä–º–ª–µ–Ω': {
                            'class': 'status-pending',
                            'message': '–ñ–¥–µ–º –≤–∞—Å –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –≤–∞–º–∏ –¥–∞—Ç—É!'
                        },
                        '–ñ–¥–µ—Ç –æ–ø–ª–∞—Ç—ã': {
                            'class': 'status-waiting-payment',
                            'message': '–û–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–∑–∏—Ü–∏–∏, –∑–∞–∫–∞–∑–∞–Ω–Ω—ã–µ –≤–∞–º–∏ –Ω–∞ –º–µ—Å—Ç–µ, —á—å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ –≤—Ö–æ–¥–∏–ª–∞ –≤ –∞–≤–∞–Ω—Å.'
                        },
                        '–ó–∞–≤–µ—Ä—à–µ–Ω': {
                            'class': 'status-completed',
                            'message': '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å!'
                        },
                        '–û—Ç–º–µ–Ω–µ–Ω': {
                            'class': 'status-cancelled',
                            'message': '–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω.'
                        }
                    } %}
                    <span class="status {{ status_info[status]['class'] }}">
                        {{ status }}
                    </span>
                </td>
                <td>
                    <span class="status-message">
                        {{ status_info[status]['message'] }}
                        {% if status == '–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–æ—Ä–º–ª–µ–Ω' %}
                            <span> ({{ time }})</span>
                        {% endif %}
                    </span>
                </td>
                {% if status == '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' %}
                    {% if id in problem_orders %}
                        <td><a class="btn-custom btn-success-custom" href="{{ url_for('bp_payment.payment_form', order_id=id) }}">–û–ø–ª–∞—Ç–∏—Ç—å –≤—ã–±–æ—Ä</a><br><br>
                         <a class="btn-custom btn-primary-custom" href="{{ url_for('bp_query.form_render', order_id=id) }}">–¢–µ–∫—É—â–∏–π —Å—á–µ—Ç</a><br><br>
                         <form action="{{ url_for('cancel_order_handler', order_id=id) }}" method="post">
                            <button class="btn-custom btn-danger-custom" type="submit">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</button>
                        </form>
                        </td>
                    {% else %}
                        <td><a class="btn-custom btn-success-custom" href="{{ url_for('bp_dish_list.basket_index', order_id=id) }}">–í—ã–±—Ä–∞—Ç—å –±–ª—é–¥–∞</a><br><br>
                         <form action="{{ url_for('cancel_order_handler', order_id=id) }}" method="post">
                            <button class="btn-custom btn-danger-custom" type="submit">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</button>
                        </form>
                        </td>
                    {% endif %}
                {% elif status == '–ñ–¥–µ—Ç –æ–ø–ª–∞—Ç—ã' %}
                    <td><a type="submit" class="btn-custom btn-success-custom" href="{{ url_for('bp_payment.payment_form', order_id=id) }}">–ö –æ–ø–ª–∞—Ç–µ</a><br><br>
                        <a class="btn-custom btn-primary-custom" href="{{ url_for('bp_query.form_render', order_id=id) }}">–ò—Ç–æ–≥–æ–≤—ã–π —Å—á–µ—Ç</a></td>
                {% elif status == '–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–æ—Ä–º–ª–µ–Ω' %}
                    <td><a class="btn-custom btn-primary-custom" href="{{ url_for('bp_query.form_render', order_id=id) }}">–¢–µ–∫—É—â–∏–π —Å—á–µ—Ç</a></td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="info-message">
            –ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç.
        </div>
    {% endif %}
</div>
{% endblock %}
